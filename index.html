<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="Canvas snake game built with JavaScript featuring HammerJS and HowlerJS">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="viewport" content="user-scalable=yes, width=device-width, initial-scale=1.0" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/web-app-manifest-192x192.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png" />
  <link rel="icon" type="image/svg+xml" href="assets/favicon/favicon.svg" />
  <link rel="shortcut icon" href="assets/favicon/favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/pay.css" type="text/css" />
  <link rel="stylesheet" href="assets/css/style.css?v=2" type="text/css" />
  <link rel="stylesheet" href="assets/css/mining.css?v=4" type="text/css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <title>Sat Snake</title>
</head>

<body>
  <div id="payment-overlay" data-hide-on-state="PLAY READY">
    <div class="bg"></div>

    <header class="shell header">
      <div class="brand">
        <img class="logo" src="assets/logo.png" alt="Nostrich Run" />
        <div class="brandText">
          <div class="brandTitle">Sat Snake</div>
          <div class="brandSub">Pay to Play • GAMESTR Leaderboard Integration</div>
        </div>
      </div>

      <!-- User Profile (top right, shows when logged in) -->
      <div class="userProfile hidden" id="userProfile">
        <img id="nostrProfilePic" src="" alt="" class="profilePic" />
        <span id="nostrProfileName" class="profileName"></span>
        <button class="btn small ghost" id="btnLogout">Logout</button>
      </div>
    </header>

    <main class="shell grid">
      <!-- NOSTR LOGIN -->
      <section class="card">
        <h2>Nostr Login</h2>
        <p class="muted">
          Optional, but recommended.
        </p>

        <div class="tabs">
          <button class="tab active" data-tab="ext">Extension</button>
          <button class="tab" data-tab="nsec">Nsec</button>
          <button class="tab" data-tab="bunker">Bunker</button>
        </div>

        <!-- Extension -->
        <div class="tabPanel active" id="tab-ext">
          <p class="muted">
            Uses a NIP-07 browser extension (<code>window.nostr</code>).
          </p>
          <button class="btn" id="btnNip07">Connect extension</button>
        </div>

        <!-- Nsec -->
        <div class="tabPanel" id="tab-nsec">
          <label class="label">Enter nsec</label>
          <div class="input-wrapper">
            <input class="input" id="nsecInput" type="password" placeholder="nsec1..." autocomplete="off" />
            <button type="button" class="eye-toggle" id="toggleNsec" aria-label="Toggle nsec visibility">
              <svg class="eye-icon" id="eyeOpen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg class="eye-icon hidden" id="eyeClosed" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path
                  d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                </path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
          </div>
          <div class="row">
            <button class="btn" id="btnNsec">Login with nsec</button>
            <button class="btn ghost" id="btnNsecClear">Clear</button>
          </div>
          <p class="warn">
            Avoid using your main key on random websites - an extension or bunker is safer.
          </p>
        </div>

        <!-- Bunker -->
        <div class="tabPanel" id="tab-bunker">
          <label class="label">Bunker connection string</label>
          <input class="input" id="bunkerInput" placeholder="bunker://...relay=..." autocomplete="off" />
          <div class="row">
            <button class="btn" id="btnBunker">Connect bunker</button>
            <button class="btn ghost" id="btnBunkerDisconnect">Clear</button>
          </div>
        </div>

        <br />
        <!-- INFO -->
        <section class="card span2">
          <h2>How it works</h2>
          <ul class="list">
            <li>(Optional) Log into your NOSTR account using Nsec, Browser Extension or Bunker.</li>
            <li>Choose your mining hashrate percentage.</li>
            <li>Pay the Lightning invoice (use NWC for instant zaps).</li>
            <li>10 Seconds of mining - each Bitcoin found rewards 10x points.</li>
            <li>Use Up/Down/Left/Right arrows (or swipe on mobile).</li>
            <li>Press SPACE (or touch with 2 fingers on mobile) to Pause.</li>
            <li>Your Nostr login and NWC wallet connection persist across sessions.</li>
          </ul>
        </section>

      </section>

      <!-- PAYMENT -->
      <section class="card">
        <h2>Pay to Play</h2>
        <p class="muted">Select hashrate percentage.</p>

        <div class="slider-container">
          <input type="range" id="timeSlider" min="1" max="5" step="1" value="3" class="slider" />
          <div id="priceLabel" class="price-label">15% Hashpower - 100 sats</div>
        </div>

        <div class="row">
          <button class="btn" id="btnCreateInvoice">Generate Invoice</button>
        </div>

        <div class="divider"></div>

        <div id="invoiceLoading" class="loadingIndicator hidden">
          <div class="spinner"></div>
          <p>Generating Invoice...</p>
        </div>

        <div id="invoiceArea" class="hidden">
          <div id="invoiceLoading" class="loadingIndicator hidden">
            <div class="spinner"></div>
            <p>Generating Invoice...</p>
          </div>
          <div class="payGrid">
            <div>
              <div id="invoiceAmountDisplay" class="label highlight-text"
                style="font-size: 1.2rem; color: #fa0; margin-bottom: 0.5rem;"></div>
              <div class="label">QR</div>
              <div class="qr-container" id="qr"></div>

              <div class="row">
                <button class="btn small" id="btnCopyInvoice">Copy invoice</button>
              </div>
            </div>

            <div>
              <div class="label">Invoice</div>
              <textarea class="textarea mono" id="invoiceText" rows="7" readonly></textarea>

              <div class="label">Payment hash</div>
              <div class="mono tiny" id="paymentHash">—</div>

              <div class="divider"></div>

              <!-- Payment Method Tabs -->
              <div class="label">Pay with Lightning</div>
              <div class="tabs paymentTabs">
                <button class="tab active" data-paytab="webln">WebLN</button>
                <button class="tab" data-paytab="nwc">NWC</button>
              </div>

              <!-- WebLN Tab Panel -->
              <div class="payTabPanel active" id="paytab-webln">
                <!-- WebLN Not Connected State -->
                <div id="weblnNotConnected">
                  <p class="muted tiny">Uses a WebLN browser extension (e.g., Alby).</p>
                  <div class="row">
                    <button class="btn" id="btnConnectWebLN">Connect Extension</button>
                  </div>
                </div>

                <!-- WebLN Connected State -->
                <div id="weblnConnected" class="hidden">
                  <div class="nwcConnectedBanner">
                    <span class="nwcConnectedIcon">⚡</span>
                    <span class="nwcConnectedText">WebLN Connected</span>
                  </div>
                  <div class="row">
                    <button class="btn" id="btnPayWebLN">Pay with WebLN</button>
                  </div>
                </div>
              </div>

              <!-- NWC Tab Panel -->
              <div class="payTabPanel" id="paytab-nwc">
                <!-- NWC Not Connected State -->
                <div id="nwcNotConnected">
                  <input class="input mono" id="nwcInput" placeholder="nostr+walletconnect://..." autocomplete="off" />
                  <div class="row">
                    <button class="btn" id="btnConnectNWC">Connect NWC Wallet</button>
                  </div>
                  <p class="muted tiny">Your NWC connection will be saved for future visits.</p>
                </div>

                <!-- NWC Connected State -->
                <div id="nwcConnected" class="hidden">
                  <div class="nwcConnectedBanner">
                    <span class="nwcConnectedIcon">⚡</span>
                    <span class="nwcConnectedText">NWC Wallet Connected</span>
                  </div>
                  <div class="row">
                    <button class="btn" id="btnPayNWC">Pay with NWC</button>
                    <button class="btn ghost small" id="btnDisconnectNWC">Disconnect</button>
                  </div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="row">
                <!-- <button class="btn ghost" id="btnCheckPaid">Check payment</button> -->
                <span class="muted tiny" id="paidHint">Waiting…</span>
              </div>
            </div>
          </div>
        </div>

        <div id="paidArea" class="hidden">
          <div class="paidBanner">
            <div class="paidTitle">Payment confirmed</div>
            <div class="muted">Access granted for this session.</div>
          </div>
          <div class="row">
            <button class="btn" id="btnPlay">Play now</button>
            <button class="btn ghost" id="btnLock">Lock</button>
          </div>
        </div>
      </section>
    </main>

    <footer class="shell footer">
      <span class="muted tiny">
        WhitepaperInteractive • Lightning backend via LNBits • GAMESTR.io Leaderboard Integration
      </span>
    </footer>
  </div>

  <!-- Mining Simulator Overlay -->
  <div id="mining-overlay">

    <!-- Start Popup -->
    <div id="mining-start">
      <h3>BITCOIN MINER SIMULATION</h3>
      <p>Your computer will now start <span id="mining-duration-text">10 seconds</span> of double SHA-256 Bitcoin
        mining.<br> You will receive 1 Bitcoin
        (worth
        10x Points) for each leading zero you find.</p>
      <button id="start-mining-btn" class="button">START MINING</button>
    </div>

    <div class="mining-header">
      <h2>MINING OPERATION IN PROGRESS...</h2>
      <div id="block-info">
        <p>BLOCK HEIGHT: <span id="block-height">840213</span></p>
        <p>VERSION: <span id="block-version">0x20000000</span></p>
        <p>DIFFICULTY: <span id="net-difficulty">86.4T</span></p>
        <p>UNIX TIME: <span id="block-time">Loading...</span></p>
        <div class="full-width">
          <p>PREV HASH: <span id="prev-hash" class="hash-text">0000000000000000000000...</span></p>
          <p>MERKLE ROOT: <span id="merkle-root" class="hash-text">Loading...</span></p>
        </div>
      </div>
    </div>

    <div id="best-hash-container">
      <h3>CURRENT BEST HASH</h3>
      <div id="best-hash-display" class="trigger-pulse">Mining...</div>
    </div>

    <div class="mining-body">
      <div class="mining-console">
        <div id="hash-stream"></div>
      </div>

      <div class="mining-sidebar">
        <div class="stat-box">
          <label>TIME REMAINING</label>
          <div id="mining-timer">10s</div>
        </div>
        <div class="stat-box">
          <label>HASHRATE</label>
          <div id="hashrate">0 H/s</div>
        </div>
        <div class="stat-box">
          <label>BEST DIFFICULTY</label>
          <div id="best-difficulty">0000...</div>
        </div>
        <div class="stat-box">
          <label>BONUS EARNED</label>
          <div id="bonus-earned">0</div>
        </div>
      </div>
    </div>

    <div id="mining-results" class="hidden">
      <h3>MINING COMPLETE</h3>
      <p>You found <span id="result-difficulty">0</span> leading zeros.</p>
      <p><strong><span id="result-bonus">0</span> BONUS BITCOINS</strong> added to the game!</p>
      <button id="start-game-btn" class="button">INITIALIZE GAME</button>
    </div>
  </div>

  <!-- GAME OVER POPUP -->
  <div id="game-over-popup" class="overlay hidden">
    <div class="popup-card">
      <h2>GAME OVER</h2>

      <div class="score-display">
        <div class="label">SCORE</div>
        <div id="finalScore" class="giant-text">0</div>
      </div>

      <div class="profile-section">
        <img id="goProfilePic" src="assets/logo.png" alt="Profile" class="profile-pic-large">
        <div id="goProfileName" class="profile-name-large">Player</div>
      </div>

      <!-- GAME OVER LOGIN OPTIONS (Only shown if guest) -->
      <div id="goLoginSection" class="hidden">
        <div class="divider"></div>
        <p class="muted tiny">Login to save your high score & share</p>

        <div class="tabs small-tabs">
          <button class="tab active" data-gotab="ext">Extension</button>
          <button class="tab" data-gotab="nsec">Nsec</button>
          <button class="tab" data-gotab="bunker">Bunker</button>
        </div>

        <!-- Extension -->
        <div class="tabPanel active" id="gotab-ext">
          <button class="btn small full-width" id="btnGoNip07">Connect Extension</button>
        </div>

        <!-- Nsec -->
        <div class="tabPanel" id="gotab-nsec">
          <div class="input-wrapper">
            <input class="input small" id="goNsecInput" type="password" placeholder="nsec1..." autocomplete="off" />
          </div>
          <button class="btn small full-width" id="btnGoNsec">Login</button>
        </div>

        <!-- Bunker -->
        <div class="tabPanel" id="gotab-bunker">
          <input class="input small" id="goBunkerInput" placeholder="bunker://..." autocomplete="off" />
          <button class="btn small full-width" id="btnGoBunker">Connect</button>
        </div>
        <div class="divider"></div>
      </div>

      <div class="action-buttons">
        <button id="btnPlayAgain" class="btn gamestr-btn secondary">Main Menu</button>
        <button id="btnLeaderboard" class="btn gamestr-btn yellow">Gamestr Leaderboard</button>
        <button id="btnShareScore" class="btn gamestr-btn primary">Share on NOSTR</button>
        <button id="btnSubmitScore" class="btn gamestr-btn accent">Submit score to Gamestr</button>
      </div>
    </div>
  </div>

  <!-- SHARE POPUP -->
  <div id="share-popup" class="overlay hidden">
    <div class="popup-card">
      <h2>Share Score</h2>
      <textarea id="shareText" class="textarea mono" rows="6"
        style="width: 100%; margin: 1rem 0; resize: vertical;"></textarea>

      <div class="action-buttons">
        <button id="btnShareNostr" class="btn gamestr-btn accent">Share on NOSTR</button>
        <button id="btnCancelShare" class="btn gamestr-btn ghost">Cancel</button>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD OVERLAY -->
  <div id="leaderboard-overlay" class="overlay hidden">
    <div class="popup-card wide">
      <div class="header-row">
        <h2>GAMESTR LEADERBOARD</h2>
        <button id="btnLeaderboardMenu" class="btn small ghost gamestr-btn">Back</button>
      </div>

      <div class="leaderboard-container">
        <ul id="leaderboard-list">
          <li>Loading scores...</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Game container -->
  <div id="game-container" class="avoid-clicks hidden" data-show-on-state="PLAY READY">

    <!-- Start Game Popup -->
    <div id="game-start-popup" class="game-start-overlay">
      <div class="game-start-content">
        <h2>READY?</h2>
        <p>Press any key or click to start</p>
        <p class="pause-hint">Press Space (or tap with 2 fingers on mobile) to pause</p>
        <button id="start-game-button" class="start-btn">START</button>
      </div>
    </div>

    <!-- NB all data fields are manipulated by game.setElementStyle() -->

    <!--  Headings -->
    <div id="instructions-heading" class="menu-heading-container hidden" data-show-on-state=""
      data-hide-on-state="PLAY PAUSE OPTIONS GAMEOVER MAIN READY">
      <h1>Sat Snake</h1>
    </div>
    <div id="scores-heading" class="menu-heading-container hidden" data-show-on-state="GAMEOVER"
      data-hide-on-state="PLAY PAUSE OPTIONS MAIN READY">
      <h1>Score Board</h1>
    </div>

    <!-- Instructions -->
    <div id="instructions-container" class="menu-content-container hidden" data-show-on-state=""
      data-hide-on-state="PLAY PAUSE OPTIONS GAMEOVER MAIN READY">
      <p>
        Use the <span class="desktop-controls-text">ARROW keys</span> or
        <span class="mobile-controls-text">SWIPE</span> anywhere to change
        direction
      </p>
      <p>
        Press <span class="desktop-controls-text">SPACE</span> or
        <span class="mobile-controls-text">TWO-FINGER TAP</span> to pause
      </p>
      <p>
        The more you eat, the bigger you grow and the
        <span class="special-menu-text">messier</span> things become
      </p>
      <p>Don't eat yourself</p>
    </div>

    <!-- Scores -->
    <div id="scores-container" class="menu-content-container hidden" data-show-on-state="GAMEOVER"
      data-hide-on-state="PLAY PAUSE OPTIONS MAIN READY">
      <p id="scores-award-text">
        You haven't achieved anything yet. Once you do, your top 5 scores of
        the session will be displayed here.
      </p>
      <div id="session-scores-container" class="hidden" data-show-on-state="PLAY">
        <ol></ol>
      </div>
    </div>

    <!-- Options -->
    <div id="options-container" class="menu-content-container hidden" data-show-on-state="OPTIONS PAUSE"
      data-hide-on-state="PLAY MAIN GAMEOVER READY">
      <div id="checkbox-container">
        <label class="options-choice-button" for="audio-checkbox">
          <input id="audio-checkbox" type="checkbox" checked />
          <span>Sound</span>
        </label>
      </div>
    </div>

    <!-- Menu buttons -->
    <div id="menu-buttons-container">
      <button id="play-button" class="button" data-show-on-state="MAIN OPTIONS GAMEOVER"
        data-hide-on-state="PLAY PAUSE READY">
        Play
      </button>
      <button id="resume-button" class="button hidden" data-show-on-state="PAUSE"
        data-hide-on-state="PLAY MAIN OPTIONS GAMEOVER READY">
        Resume
      </button>
      <button id="scores-button" class="button" data-show-on-state="MAIN"
        data-hide-on-state="PLAY PAUSE GAMEOVER READY">
        Scores
      </button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="canvas" class="hidden paused-effect" data-show-on-state="PLAY READY"
    data-blur-on-state="PAUSE MAIN OPTIONS GAMEOVER READY" data-unblur-on-state="PLAY"></canvas>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.0/howler.min.js"></script>
  <script type="module" src="assets/js/pay.js?v=3"></script>
  <script src="assets/js/gamestr.js?v=3"></script>
  <script src="assets/js/mining.js?v=3"></script>
  <script src="assets/js/script.js?v=3"></script>
  <script src="assets/js/scoreboard.js?v=3"></script>
</body>

</html>